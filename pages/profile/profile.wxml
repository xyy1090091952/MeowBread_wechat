<!--pages/profile/profile.wxml-->
<view class="container {{!isLoggedIn ? 'login-mode' : ''}}">
  <!-- 用户信息区域 - 自定义全屏容器 -->
  <view class="fullscreen-user-section">
    <!-- 未登录时显示 -->
    <block wx:if="{{!isLoggedIn}}">
      <view class="login-card shadow">
        <text class="login-title">始めましょう</text>
        <text class="login-subtitle">在Meow Bread开心得背单词吧！</text>

        <!-- 头像占位渐变圆 - 支持显示选中的头像 -->
        <view class="avatar-placeholder">
          <image wx:if="{{avatarUrl && avatarUrl !== '/images/icons/profile.png'}}" class="avatar-preview" src="{{avatarUrl}}" mode="aspectFill"></image>
        </view>

        <!-- 选头像按钮 -->
        <button class="avatar-btn" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">{{avatarUrl ? '更换头像' : '选择头像'}}</button>

        <!-- 昵称输入框 - 微信推荐方式 -->
        <input class="nickname-input {{nickname ? 'has-nickname' : ''}}" type="nickname" placeholder="请输入昵称" bind:input="onNicknameInput" value="{{nickname}}" />

        <!-- 登录按钮 -->
        <view class="login-btn" bindtap="login">保存并登录</view>
      </view>
    </block>
    
    <!-- 登录后显示用户信息 -->
    <block wx:if="{{isLoggedIn && userInfo}}">
      <!-- 显示用户真实头像 -->
      <image class="avatar" src="{{userInfo.avatarUrl}}"></image>
      <view class="user-text-container">
        <!-- 显示用户昵称 -->
        <view class="user-name">{{userInfo.nickName}}</view>
        <!-- 显示用户称号（根据答题数量动态计算） -->
        <view class="user-title">{{userTitle}}</view>
      </view>
    </block>
  </view>

  <!-- 登录后显示的功能模块 -->
  <block wx:if="{{isLoggedIn}}">
    <!-- 答题结果模块 -->
    <view class="quiz-results-section fade-in-element fade-delay-2 {{pageLoaded ? 'show' : ''}}">
      <!-- 内层答题准确率模块 -->
      <view class="accuracy-module">
        <text class="accuracy-label">答题准确率</text>
        <text class="accuracy-value">{{statistics.averageAccuracy}}%</text>
      </view>
      <!-- 底部统计和详细数据区域 -->
      <view class="bottom-stats-area">
        <text class="stats-text">共答题{{statistics.totalQuestions}}道，答对{{statistics.correctAnswers}}道</text>
                 <view class="detail-btn" bindtap="goToQuizDetails">
           <text class="detail-text">查看详细数据</text>
           <image class="detail-arrow" src="/images/icons/arrow_right.svg"></image>
         </view>
      </view>
    </view>

    <!-- 扭蛋机模块 -->
    <view class="gashapon-section fade-in-element fade-delay-3 {{pageLoaded ? 'show' : ''}}" bindtap="goToGashapon">
      <image class="gashapon-background" src="/images/banner/gashapon.jpg"></image>
      <view class="option-text-container">
        <text class="option-main-text">单词扭蛋机</text>
      </view>
      <image class="option-icon arrow-gashapon" src="/images/icons/arrow_right.svg"></image>
    </view>

    <!-- 错题库模块 -->
    <view class="mistake-section fade-in-element fade-delay-4 {{pageLoaded ? 'show' : ''}}" bindtap="goToMistakes">
      <view class="option-text-container">
        <text class="option-main-text">错题库</text>
        <text class="option-sub-text">{{mistakeCount}}个错误</text>
      </view>
      <image class="option-icon arrow-white" src="/images/icons/arrow_right.svg"></image>
    </view>
  </block>
</view>
