<!--pages/card-study/card-study.wxml-->
<wxs module="utils" src="../../utils/utils.wxs"></wxs>
<view class="container" wx:if="{{allWords.length > 0}}">
  <!-- ç­›é€‰æ¡ä»¶æ˜¾ç¤º -->
  <view class="current-filter-display fade-in-element fade-delay-1 {{pageLoaded ? 'show' : ''}}" wx:if="{{currentFilterDisplay}}">
    <text>ä½ å½“å‰é€‰æ‹©äº†: {{currentFilterDisplay}}</text>
  </view>
  
  <!-- è¿›åº¦æ¡å’Œè®¡æ—¶å™¨å®¹å™¨ -->
  <view class="progress-timer-container fade-in-element fade-delay-2 {{pageLoaded ? 'show' : ''}}">
    <!-- è¿›åº¦æ¡ -->
    <view class="progress-bar-wrapper">
      <view class="progress-bar-background">
        <view class="progress-bar-foreground" style="width: {{((currentWordIndex + 1) / totalWords) * 100}}%;"></view>
      </view>
      <!-- è¿›åº¦æ–‡å­— -->
      <view class="progress-text">
        <text>{{currentWordIndex + 1}} / {{totalWords}}</text>
      </view>
    </view>

    <!-- è®¡æ—¶å™¨ -->
    <view class="timer-box">
      <image class="timer-icon" src="/images/icons/timericon.png"></image>
      <text class="timer-text">{{formattedTime}}</text>
    </view>
  </view>

  <!-- æ ‡é¢˜æ¨¡å— -->
  <view class="title-section fade-in-element fade-delay-2 {{pageLoaded ? 'show' : ''}}">
    <text class="main-title">å¾©ä¹ æ¨¡å¼</text>
    <text class="subtitle">ğŸ‘ˆå·¦æ»‘å¿˜è®°å•è¯å›åˆ°é”™é¢˜åº“ï¼ŒğŸ‘‰å³æ»‘è®°ä½</text>
  </view>

  <!-- å¡ç‰‡å®¹å™¨ -->
  <view class="card-container fade-in-element fade-delay-3 {{pageLoaded ? 'show' : ''}}">
    <!-- å·¦ä¾§å¿«æ·æŒ‰é’® - å¿˜è®° -->
    <view class="card-side-button card-side-button-left" bindtap="onForgetClick">
      <image class="card-side-button-icon left" src="/images/icons/arrow_right.svg"></image>
    </view>
    
    <!-- å³ä¾§å¿«æ·æŒ‰é’® - è®°ä½ -->
    <view class="card-side-button card-side-button-right" bindtap="onRememberClick">
      <image class="card-side-button-icon right" src="/images/icons/arrow_right.svg"></image>
    </view>
    
    <!-- ä¸‹ä¸€å¼ å¡ç‰‡ï¼ˆèƒŒæ™¯å¡ç‰‡ï¼‰ -->
    <view class="study-card background-card" wx:if="{{nextCard}}" style="transform: {{backgroundCardTransform}}; opacity: {{backgroundCardOpacity}};">
      <!-- ç™½è‰²ä¸é€æ˜åº• -->
      <view class="card-white-background"></view>
      <!-- èƒŒæ™¯å›¾ç‰‡ -->
      <image class="card-background-image" src="/images/card/N5-Card{{nextCardStyleType}}.jpg" mode="aspectFill"></image>
      <!-- èƒŒæ™¯é®ç½© -->
      <view class="card-background-overlay"></view>
      
      <view class="word-main">
        <!-- ç¬¬ä¸€è¡Œï¼šè¯æ€§æ ‡ç­¾ -->
        <view class="part-of-speech-tag {{utils.mapPartOfSpeechToClassName(nextCard['è¯æ€§'])}}">
          {{nextCard['è¯æ€§']}}
        </view>
        <!-- ç¬¬äºŒè¡Œï¼šå•è¯æ–‡æœ¬ -->
        <text class="word-text">{{nextCard['æ±‰å­—'] ? nextCard['æ±‰å­—'] : nextCard['å‡å']}}</text>
        <!-- ç¬¬ä¸‰è¡Œï¼šæ±‰å­—å’Œä¸­æ–‡ -->
        <view class="word-details-line">
          <text class="detail-value" wx:if="{{nextCard['æ±‰å­—']}}">{{nextCard['æ±‰å­—']}}</text>
          <text class="separator" wx:if="{{nextCard['æ±‰å­—']}}"> | </text>
          <text class="detail-value">{{nextCard['ä¸­æ–‡']}}</text>
        </view>
        <!-- ç¬¬å››è¡Œï¼šä¾‹å¥ -->
        <text class="example-line" wx:if="{{nextCard['ä¾‹å¥']}}">ä¾‹å¥ï¼š{{nextCard['ä¾‹å¥']}}</text>
      </view>
      <view class="card-content">
        <!-- è¯¾ç¨‹èŠ‚æ•° -->
        <view class="lesson-number">
          <text>ç¬¬{{nextCard['è¯¾ç¨‹èŠ‚æ•°'] || 1}}è¯¾</text>
        </view>
      </view>
    </view>

    <!-- å½“å‰å¡ç‰‡è§¦å‘åŒºåŸŸï¼ˆæ‰©å¤§çš„è§¦æ‘¸åŒºåŸŸï¼‰ -->
    <view 
      class="card-touch-area {{isCardAnimating ? 'animating' : ''}}" 
      wx:if="{{currentCard}}"
      bindtouchstart="onTouchStart"
      bindtouchmove="onTouchMove"
      bindtouchend="onTouchEnd">
      
      <!-- å½“å‰å¡ç‰‡ï¼ˆå‰æ™¯å¡ç‰‡ï¼‰ -->
      <view class="study-card current-card" style="transform: {{cardTransform}}; transition: {{isCardAnimating ? 'transform 0.3s ease-out' : 'none'}};">
      
      <!-- ç™½è‰²ä¸é€æ˜åº• -->
      <view class="card-white-background"></view>
      <!-- èƒŒæ™¯å›¾ç‰‡ -->
      <image class="card-background-image" src="/images/card/N5-Card{{currentCardStyleType}}.jpg" mode="aspectFill"></image>
      <!-- èƒŒæ™¯é®ç½© -->
      <view class="card-background-overlay"></view>
      
      <view class="word-main">
        <!-- ç¬¬ä¸€è¡Œï¼šè¯æ€§æ ‡ç­¾ -->
        <view class="part-of-speech-tag {{utils.mapPartOfSpeechToClassName(currentCard['è¯æ€§'])}}">
          {{currentCard['è¯æ€§']}}
        </view>
        <!-- ç¬¬äºŒè¡Œï¼šå•è¯æ–‡æœ¬ -->
        <text class="word-text">{{currentCard['æ±‰å­—'] ? currentCard['æ±‰å­—'] : currentCard['å‡å']}}</text>
        <!-- ç¬¬ä¸‰è¡Œï¼šæ±‰å­—å’Œä¸­æ–‡ -->
        <view class="word-details-line">
          <text class="detail-value" wx:if="{{currentCard['æ±‰å­—']}}">{{currentCard['æ±‰å­—']}}</text>
          <text class="separator" wx:if="{{currentCard['æ±‰å­—']}}"> | </text>
          <text class="detail-value">{{currentCard['ä¸­æ–‡']}}</text>
        </view>
        <!-- ç¬¬å››è¡Œï¼šä¾‹å¥ -->
        <text class="example-line" wx:if="{{currentCard['ä¾‹å¥']}}">ä¾‹å¥ï¼š{{currentCard['ä¾‹å¥']}}</text>
      </view>
      
      <view class="card-content">
        <!-- è¯¾ç¨‹èŠ‚æ•° -->
        <view class="lesson-number">
          <text>ç¬¬{{currentCard['è¯¾ç¨‹èŠ‚æ•°'] || 1}}è¯¾</text>
        </view>
      </view>
      
      <!-- æ»‘åŠ¨æç¤º -->
      <view class="swipe-hints">
        <view class="hint-left">
          <text>æ²¡è®°ä½</text>
        </view>
        <view class="hint-right">
          <text>è®°ä½äº†</text>
        </view>
      </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons fade-in-element fade-delay-4 {{pageLoaded ? 'show' : ''}}">
    <button class="action-button forget-button" bindtap="onForgetClick">
      <text>å¿˜è®° {{forgottenCount}}</text>
    </button>
    <button class="action-button remember-button" bindtap="onRememberClick">
      <text>è®°ä½ {{rememberedCount}}</text>
    </button>
  </view>

  <!-- é€€å‡ºæŒ‰é’® -->
  <view class="exit-button-container fade-in-element fade-delay-5 {{pageLoaded ? 'show' : ''}}">
    <view class="next-button full-width-button" bindtap="onExitStudy">
      é€€å‡ºå¾©ä¹ æ¨¡å¼
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{isLoading}}">
  <text>æ­£åœ¨åŠ è½½å•è¯...</text>
</view>

<!-- æ— æ•°æ®çŠ¶æ€ -->
<view class="empty-container" wx:if="{{!isLoading && allWords.length === 0}}">
  <text>æ²¡æœ‰å¯å­¦ä¹ çš„å•è¯</text>
</view> 