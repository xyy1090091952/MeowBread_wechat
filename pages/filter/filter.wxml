<!--pages/filter/filter.wxml-->
<textbook-selector
  visible="{{isSelectorVisible}}"
  bind:select="onConfirmTextbook"
  bind:close="onCancelTextbook"
/>
<view class="page-container">
  <view class="section-card">
    <view class="section-title">词库选择</view>
    <view class="filter-item">
      <view class="filter-item-label">选择教材：</view>
      <view class="picker-display" bindtap="showTextbookSelector">
        {{dictionaries[selectedDictionaryIndex].name || '请选择教材'}}
        <image class="picker-arrow" src="/images/icons/arrow-right.svg" />
      </view>
    </view>

    <view class="filter-item">
      <view class="filter-item-label">选择课程：</view>
      <picker mode="selector" range="{{lessons}}" range-key="name" value="{{selectedLessonIndex}}" bindchange="onLessonChange" disabled="{{lessons.length === 0 && selectedDictionaryIndex === null}}">
        <view class="picker-display {{ (lessons.length === 0 && selectedDictionaryIndex === null) ? 'disabled' : '' }}">
          {{selectedLessonIndex !== null && lessons[selectedLessonIndex] ? lessons[selectedLessonIndex].name : (selectedDictionaryIndex !== null ? (lessons.length > 0 ? '请选择课程' : '该词典下暂无课程') : '请先选择教材')}}
          <image class="picker-arrow" src="/images/icons/arrow-right.svg" />
        </view>
      </picker>
    </view>
  </view>

  <view class="section-card">
    <view class="section-title">题型选择</view>
    <view class="question-type-group">
      <view class="question-type-group-title">选择题：</view>
      <label class="switch-item" wx:for="{{questionTypeOptions}}" wx:if="{{item.category === '选择题'}}" wx:key="value">
        <text class="switch-label">{{item.name}}</text>
        <switch checked="{{item.checked}}" bindchange="onQuestionTypeChange" data-value="{{item.value}}" color="#4845F7"/>
      </label>
    </view>
    <view class="question-type-group">
      <view class="question-type-group-title">填空题：</view>
      <label class="switch-item" wx:for="{{questionTypeOptions}}" wx:if="{{item.category === '填空题'}}" wx:key="value">
        <text class="switch-label">{{item.name}}</text>
        <switch checked="{{item.checked}}" bindchange="onQuestionTypeChange" data-value="{{item.value}}" color="#4845F7"/>
      </label>
    </view>
  </view>

  <button class="confirm-button" type="primary" bindtap="startQuiz" disabled="{{!selectedLessonFile}}">完成选择</button>
</view>